<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script><script src="https://unpkg.com/three@0.129.0/build/three.min.js"></script><style type="text/css">#map{height:100%}body,html{height:100%;margin:0;padding:0}#map{pointer-events:none}</style><script>(()=>{"use strict";var r={d:(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},e={};r.r(e),r.d(e,{initMap:()=>function(){var e=document.getElementById("map");H=new google.maps.Map(e,D);const a=new v.Scene,t=new v.AmbientLight(16777215,.75);a.add(t);const s=new v.DirectionalLight(16777215,.25);s.position.set(0,10,50),a.add(s),(new n).load("https://raw.githubusercontent.com/googlemaps/js-samples/master/assets/pin.gltf",e=>{e.scene.scale.set(10,10,10),e.scene.rotation.x=Math.PI/2,a.add(e.scene);let{tilt:t,heading:s,zoom:r}=D;const n=()=>{if(t<67.5)t+=.5;else{if(!(s<=360))return;s+=.2,r-=5e-4}H.moveCamera({tilt:t,heading:s,zoom:r}),requestAnimationFrame(n)};requestAnimationFrame(n)}),new U({map:H,scene:a,anchor:{...D.center,altitude:100}})}});const v=window.THREE;class n extends v.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new a(e)}),this.register(function(e){return new i(e)}),this.register(function(e){return new l(e)}),this.register(function(e){return new o(e)}),this.register(function(e){return new t(e)}),this.register(function(e){return new h(e)})}load(t,s,e,r){const n=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:v.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);function o(e){r?r(e):console.error(e),n.manager.itemError(t),n.manager.itemEnd(t)}const i=new v.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,function(e){try{n.parse(e,a,function(e){s(e),n.manager.itemEnd(t)},o)}catch(e){o(e)}},e,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,r){let n;const a={},o={};if("string"==typeof e)n=e;else if(v.LoaderUtils.decodeText(new Uint8Array(e,0,4))===d){try{a[u.KHR_BINARY_GLTF]=new p(e)}catch(e){return void(r&&r(e))}n=a[u.KHR_BINARY_GLTF].content}else n=v.LoaderUtils.decodeText(new Uint8Array(e));var i=JSON.parse(n);if(void 0===i.asset||i.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{const l=new O(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);o[t.name]=t,a[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],v=i.extensionsRequired||[];switch(t){case u.KHR_MATERIALS_UNLIT:a[t]=new c;break;case u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[t]=new T;break;case u.KHR_DRACO_MESH_COMPRESSION:a[t]=new m(i,this.dracoLoader);break;case u.KHR_TEXTURE_TRANSFORM:a[t]=new f;break;case u.KHR_MESH_QUANTIZATION:a[t]=new x;break;default:0<=v.indexOf(t)&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(s,r)}}}function s(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const u={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class t{constructor(e){this.parser=e,this.name=u.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const s=this.parser,r=this.parser.json.nodes||[];for(let e=0,t=r.length;e<t;e++){var n=r[e];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&s._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let r=t.cache.get(s);if(r)return r;const n=t.json,a=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let o;const i=new v.Color(16777215);void 0!==a.color&&i.fromArray(a.color);var l=void 0!==a.range?a.range:0;switch(a.type){case"directional":o=new v.DirectionalLight(i),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new v.PointLight(i),o.distance=l;break;case"spot":o=new v.SpotLight(i),o.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,o.angle=a.spot.outerConeAngle,o.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return o.position.set(0,0,0),o.decay=2,void 0!==a.intensity&&(o.intensity=a.intensity),o.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(o),t.cache.add(s,r),r}createNodeAttachment(e){const t=this,s=this.parser,r=s.json.nodes[e],n=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return s._getNodeRef(t.cache,n,e)})}}class c{constructor(){this.name=u.KHR_MATERIALS_UNLIT}getMaterialType(){return v.MeshBasicMaterial}extendParams(e,t,s){const r=[];e.color=new v.Color(1,1,1),e.opacity=1;t=t.pbrMetallicRoughness;if(t){if(Array.isArray(t.baseColorFactor)){const n=t.baseColorFactor;e.color.fromArray(n),e.opacity=n[3]}void 0!==t.baseColorTexture&&r.push(s.assignTexture(e,"map",t.baseColorTexture))}return Promise.all(r)}}class a{constructor(e){this.parser=e,this.name=u.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?v.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(s.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(s.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new v.Vector2(e,-e)}return Promise.all(n)}}class o{constructor(e){this.parser=e,this.name=u.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?v.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(s.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}}class i{constructor(e){this.parser=e,this.name=u.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,r=s.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var n=r.extensions[this.name],a=s.images[n.source],n=t.options.ktx2Loader;if(n)return t.loadTextureImage(e,a,n);if(s.extensionsRequired&&0<=s.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}}class l{constructor(e){this.parser=e,this.name=u.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const s=this.name,r=this.parser,n=r.json,e=n.textures[t];if(!e.extensions||!e.extensions[s])return null;const a=e.extensions[s],o=n.images[a.source];let i=r.textureLoader;if(o.uri){const t=r.options.manager.getHandler(o.uri);null!==t&&(i=t)}return this.detectSupport().then(function(e){if(e)return r.loadTextureImage(t,o,i);if(n.extensionsRequired&&0<=n.extensionsRequired.indexOf(s))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class h{constructor(e){this.name=u.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(o){const e=this.parser.json,t=e.bufferViews[o];if(t.extensions&&t.extensions[this.name]){const o=t.extensions[this.name],s=this.parser.getDependency("buffer",o.buffer),i=this.parser.options.meshoptDecoder;if(i&&i.supported)return Promise.all([s,i.ready]).then(function(e){var t=o.byteOffset||0,s=o.byteLength||0,r=o.count,n=o.byteStride,a=new ArrayBuffer(r*n),s=new Uint8Array(e[0],t,s);return i.decodeGltfBuffer(new Uint8Array(a),r,n,s,o.mode,o.filter),a});if(e.extensionsRequired&&0<=e.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null}}const d="glTF";class p{constructor(e){this.name=u.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:v.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==d)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,r=new DataView(e,12);let n=0;for(;n<s;){const t=r.getUint32(n,!0);n+=4;const s=r.getUint32(n,!0);if(n+=4,1313821514===s){const s=new Uint8Array(e,12+n,t);this.content=v.LoaderUtils.decodeText(s)}else if(5130562===s){const v=12+n;this.body=e.slice(v,v+t)}n+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class m{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=u.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},i={},l={};for(const e in a){const t=A[e]||e.toLowerCase();o[t]=a[e]}for(const t in e.attributes){const n=A[t]||t.toLowerCase();if(void 0!==a[t]){const r=s.accessors[e.attributes[t]],a=y[r.componentType];l[n]=a,i[n]=!0===r.normalized}}return t.getDependency("bufferView",r).then(function(e){return new Promise(function(r){n.decodeDracoFile(e,function(e){for(const r in e.attributes){const t=e.attributes[r],s=i[r];void 0!==s&&(t.normalized=s)}r(e)},o,l)})})}}class f{constructor(){this.name=u.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class g extends v.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),n=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new v.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",n).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){(o.specularMap.value=e)?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){(o.glossinessMap.value=e)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class T{constructor(){this.name=u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return g}extendParams(e,t,s){t=t.extensions[this.name];e.color=new v.Color(1,1,1),e.opacity=1;const r=[];if(Array.isArray(t.diffuseFactor)){const n=t.diffuseFactor;e.color.fromArray(n),e.opacity=n[3]}if(void 0!==t.diffuseTexture&&r.push(s.assignTexture(e,"map",t.diffuseTexture)),e.emissive=new v.Color(0,0,0),e.glossiness=void 0!==t.glossinessFactor?t.glossinessFactor:1,e.specular=new v.Color(1,1,1),Array.isArray(t.specularFactor)&&e.specular.fromArray(t.specularFactor),void 0!==t.specularGlossinessTexture){const n=t.specularGlossinessTexture;r.push(s.assignTexture(e,"glossinessMap",n)),r.push(s.assignTexture(e,"specularMap",n))}return Promise.all(r)}createMaterial(e){const t=new g(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=v.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class x{constructor(){this.name=u.KHR_MESH_QUANTIZATION}}class M extends v.Interpolant{constructor(e,t,s,r){super(e,t,s,r)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,r=this.valueSize,n=e*r*3+r;for(let e=0;e!==r;e++)t[e]=s[n+e];return t}}M.prototype.beforeStart_=M.prototype.copySampleValue_,M.prototype.afterEnd_=M.prototype.copySampleValue_,M.prototype.interpolate_=function(e,t,s,r){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,i=2*o,l=3*o,c=r-t,u=(s-t)/c,h=u*u,d=h*u,p=e*l,m=p-l,f=-2*d+3*h,g=d-h,v=1-f,T=g-h+u;for(let e=0;e!==o;e++){const t=a[m+e+o],s=a[m+e+i]*c,r=a[p+e+o],l=a[p+e]*c;n[e]=v*t+T*s+f*r+g*l}return n};const y={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},R={9728:v.NearestFilter,9729:v.LinearFilter,9984:v.NearestMipmapNearestFilter,9985:v.LinearMipmapNearestFilter,9986:v.NearestMipmapLinearFilter,9987:v.LinearMipmapLinearFilter},S={33071:v.ClampToEdgeWrapping,33648:v.MirroredRepeatWrapping,10497:v.RepeatWrapping},w={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},b={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},_={CUBICSPLINE:void 0,LINEAR:v.InterpolateLinear,STEP:v.InterpolateDiscrete};function E(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function L(e,t,s){for(const r in s.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=s.extensions[r])}function I(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function P(s){let r="";var n=Object.keys(s).sort();for(let e=0,t=n.length;e<t;e++)r+=n[e]+":"+s[n[e]]+";";return r}function C(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class O{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new s,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new v.ImageBitmapLoader(this.options.manager):this.textureLoader=new v.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new v.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(s,e){const r=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(e){const t={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:r,userData:{}};L(a,t,n),I(t,n),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(t)})).then(function(){s(t)})}).catch(e)}_markDefs(){const s=this.json.nodes||[],r=this.json.skins||[],n=this.json.meshes||[];for(let e=0,t=r.length;e<t;e++){var a=r[e].joints;for(let e=0,t=a.length;e<t;e++)s[a[e]].isBone=!0}for(let e=0,t=s.length;e<t;e++){var o=s[e];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(n[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const r=s.clone();return r.name+="_instance_"+e.uses[t]++,r}_invokeOne(t){const s=Object.values(this.plugins);s.push(this);for(let e=0;e<s.length;e++){var r=t(s[e]);if(r)return r}return null}_invokeAll(t){const s=Object.values(this.plugins);s.unshift(this);const r=[];for(let e=0;e<s.length;e++){var n=t(s[e]);n&&r.push(n)}return r}getDependency(e,t){var s=e+":"+t;let r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,r)}return r}getDependencies(s){let e=this.cache.get(s);if(!e){const r=this,t=this.json[s+("mesh"===s?"es":"s")]||[];e=Promise.all(t.map(function(e,t){return r.getDependency(s,t)})),this.cache.add(s,e)}return e}loadBuffer(e){const s=this.json.buffers[e],r=this.fileLoader;if(s.type&&"arraybuffer"!==s.type)throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(void 0===s.uri&&0===e)return Promise.resolve(this.extensions[u.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(e,t){r.load(E(s.uri,n.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(e){const r=this.json.bufferViews[e];return this.getDependency("buffer",r.buffer).then(function(e){var t=r.byteLength||0,s=r.byteOffset||0;return e.slice(s,s+t)})}loadAccessor(e){const h=this,d=this.json,p=this.json.accessors[e];if(void 0===p.bufferView&&void 0===p.sparse)return Promise.resolve(null);const t=[];return void 0!==p.bufferView?t.push(this.getDependency("bufferView",p.bufferView)):t.push(null),void 0!==p.sparse&&(t.push(this.getDependency("bufferView",p.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",p.sparse.values.bufferView))),Promise.all(t).then(function(t){const s=t[0],r=w[p.type],n=y[p.componentType],a=n.BYTES_PER_ELEMENT,e=a*r,o=p.byteOffset||0,i=void 0!==p.bufferView?d.bufferViews[p.bufferView].byteStride:void 0,l=!0===p.normalized;let c,u;if(i&&i!==e){const t=Math.floor(o/i),d="InterleavedBuffer:"+p.bufferView+":"+p.componentType+":"+t+":"+p.count;let e=h.cache.get(d);e||(c=new n(s,t*i,p.count*i/a),e=new v.InterleavedBuffer(c,i/a),h.cache.add(d,e)),u=new v.InterleavedBufferAttribute(e,r,o%i/a,l)}else c=null===s?new n(p.count*r):new n(s,o,p.count*r),u=new v.BufferAttribute(c,r,l);if(void 0!==p.sparse){const h=w.SCALAR,d=y[p.sparse.indices.componentType],a=p.sparse.indices.byteOffset||0,e=p.sparse.values.byteOffset||0,o=new d(t[1],a,p.sparse.count*h),i=new n(t[2],e,p.sparse.count*r);null!==s&&(u=new v.BufferAttribute(u.array.slice(),u.itemSize,u.normalized));for(let e=0,t=o.length;e<t;e++){const h=o[e];if(u.setX(h,i[e*r]),2<=r&&u.setY(h,i[e*r+1]),3<=r&&u.setZ(h,i[e*r+2]),4<=r&&u.setW(h,i[e*r+3]),5<=r)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return u})}loadTexture(e){const t=this.json,s=this.options,r=t.textures[e],n=t.images[r.source];let a=this.textureLoader;if(n.uri){const e=s.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,n,a)}loadTextureImage(s,t,n){const r=this,a=this.json,o=this.options,i=a.textures[s],e=(t.uri||t.bufferView)+":"+i.sampler;if(this.textureCache[e])return this.textureCache[e];const l=self.URL||self.webkitURL;let c=t.uri||"",u=!1,h=!0;var d=0<c.search(/\.jpe?g($|\?)/i)||0===c.search(/^data\:image\/jpeg/);if("image/jpeg"!==t.mimeType&&!d||(h=!1),void 0!==t.bufferView)c=r.getDependency("bufferView",t.bufferView).then(function(e){if("image/png"===t.mimeType){const t=new DataView(e,25,1).getUint8(0,!1);h=6===t||4===t||3===t}u=!0;e=new Blob([e],{type:t.mimeType});return c=l.createObjectURL(e),c});else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+s+" is missing URI and bufferView");d=Promise.resolve(c).then(function(r){return new Promise(function(t,e){let s=t;!0===n.isImageBitmapLoader&&(s=function(e){t(new v.CanvasTexture(e))}),n.load(E(r,o.path),s,void 0,e)})}).then(function(e){!0===u&&l.revokeObjectURL(c),e.flipY=!1,i.name&&(e.name=i.name),h||(e.format=v.RGBFormat);var t=(a.samplers||{})[i.sampler]||{};return e.magFilter=R[t.magFilter]||v.LinearFilter,e.minFilter=R[t.minFilter]||v.LinearMipmapLinearFilter,e.wrapS=S[t.wrapS]||v.RepeatWrapping,e.wrapT=S[t.wrapT]||v.RepeatWrapping,r.associations.set(e,{type:"textures",index:s}),e});return this.textureCache[e]=d}assignTexture(t,s,r){const n=this;return this.getDependency("texture",r.index).then(function(e){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===s&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+s+" not yet supported."),n.extensions[u.KHR_TEXTURE_TRANSFORM]){const t=void 0!==r.extensions?r.extensions[u.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const s=n.associations.get(e);e=n.extensions[u.KHR_TEXTURE_TRANSFORM].extendTexture(e,t),n.associations.set(e,s)}}t[s]=e})}assignFinalMaterial(t){const e=t.geometry;let s=t.material;var r=void 0!==e.attributes.tangent,n=void 0!==e.attributes.color,a=void 0===e.attributes.normal,o=0<Object.keys(e.morphAttributes).length,i=o&&void 0!==e.morphAttributes.normal;if(t.isPoints){const t="PointsMaterial:"+s.uuid;let e=this.cache.get(t);e||(e=new v.PointsMaterial,v.Material.prototype.copy.call(e,s),e.color.copy(s.color),e.map=s.map,e.sizeAttenuation=!1,this.cache.add(t,e)),s=e}else if(t.isLine){const t="LineBasicMaterial:"+s.uuid;let e=this.cache.get(t);e||(e=new v.LineBasicMaterial,v.Material.prototype.copy.call(e,s),e.color.copy(s.color),this.cache.add(t,e)),s=e}if(r||n||a||o){let e="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),r&&(e+="vertex-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:"),o&&(e+="morph-targets:"),i&&(e+="morph-normals:");let t=this.cache.get(e);t||(t=s.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),o&&(t.morphTargets=!0),i&&(t.morphNormals=!0),r&&(t.vertexTangents=!0,t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}s.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=s}getMaterialType(){return v.MeshStandardMaterial}loadMaterial(t){const s=this,e=this.json,r=this.extensions,n=e.materials[t];let a;const o={},i=n.extensions||{},l=[];if(i[u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=r[u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=t.getMaterialType(),l.push(t.extendParams(o,n,s))}else if(i[u.KHR_MATERIALS_UNLIT]){const t=r[u.KHR_MATERIALS_UNLIT];a=t.getMaterialType(),l.push(t.extendParams(o,n,s))}else{const e=n.pbrMetallicRoughness||{};if(o.color=new v.Color(1,1,1),o.opacity=1,Array.isArray(e.baseColorFactor)){const t=e.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==e.baseColorTexture&&l.push(s.assignTexture(o,"map",e.baseColorTexture)),o.metalness=void 0!==e.metallicFactor?e.metallicFactor:1,o.roughness=void 0!==e.roughnessFactor?e.roughnessFactor:1,void 0!==e.metallicRoughnessTexture&&(l.push(s.assignTexture(o,"metalnessMap",e.metallicRoughnessTexture)),l.push(s.assignTexture(o,"roughnessMap",e.metallicRoughnessTexture))),a=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)})))}!0===n.doubleSided&&(o.side=v.DoubleSide);var c=n.alphaMode||"OPAQUE";return"BLEND"===c?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,"MASK"===c&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&a!==v.MeshBasicMaterial&&(l.push(s.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new v.Vector2(1,-1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,-n.normalTexture.scale)),void 0!==n.occlusionTexture&&a!==v.MeshBasicMaterial&&(l.push(s.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&a!==v.MeshBasicMaterial&&(o.emissive=(new v.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&a!==v.MeshBasicMaterial&&l.push(s.assignTexture(o,"emissiveMap",n.emissiveTexture)),Promise.all(l).then(function(){let e;return e=a===g?r[u.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new a(o),n.name&&(e.name=n.name),e.map&&(e.map.encoding=v.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=v.sRGBEncoding),I(e,n),s.associations.set(e,{type:"materials",index:t}),n.extensions&&L(r,e,n),e})}createUniqueName(e){var t=v.PropertyBinding.sanitizeNodeName(e||"");let s=t;for(let e=1;this.nodeNamesUsed[s];++e)s=t+"_"+e;return this.nodeNamesUsed[s]=!0,s}loadGeometries(s){const r=this,n=this.extensions,a=this.primitiveCache;const o=[];for(let e=0,t=s.length;e<t;e++){var i=s[e],l=(l=void 0,(l=(c=i).extensions&&c.extensions[u.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+P(l.attributes):c.indices+":"+P(c.attributes)+":"+c.mode),c=a[l];c?o.push(c.promise):(c=i.extensions&&i.extensions[u.KHR_DRACO_MESH_COMPRESSION]?function(t){return n[u.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,r).then(function(e){return N(e,t,r)})}(i):N(new v.BufferGeometry,i,r),a[l]={primitive:i,promise:c},o.push(c))}var c,l;return Promise.all(o)}loadMesh(l){const c=this,e=this.json,u=this.extensions,h=e.meshes[l],d=h.primitives,s=[];for(let e=0,t=d.length;e<t;e++){const c=void 0===d[e].material?(void 0===(r=this.cache).DefaultMaterial&&(r.DefaultMaterial=new v.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:v.FrontSide})),r.DefaultMaterial):this.getDependency("material",d[e].material);s.push(c)}var r;return s.push(c.loadGeometries(d)),Promise.all(s).then(function(e){const s=e.slice(0,e.length-1),r=e[e.length-1],n=[];for(let t=0,e=r.length;t<e;t++){const o=r[t],i=d[t];let e;var a=s[t];if(4===i.mode||5===i.mode||6===i.mode||void 0===i.mode)e=new(!0===h.isSkinnedMesh?v.SkinnedMesh:v.Mesh)(o,a),!0!==e.isSkinnedMesh||e.geometry.attributes.skinWeight.normalized||e.normalizeSkinWeights(),5===i.mode?e.geometry=F(e.geometry,v.TriangleStripDrawMode):6===i.mode&&(e.geometry=F(e.geometry,v.TriangleFanDrawMode));else if(1===i.mode)e=new v.LineSegments(o,a);else if(3===i.mode)e=new v.Line(o,a);else if(2===i.mode)e=new v.LineLoop(o,a);else{if(0!==i.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+i.mode);e=new v.Points(o,a)}0<Object.keys(e.geometry.morphAttributes).length&&function(s,r){if(s.updateMorphTargets(),void 0!==r.weights)for(let e=0,t=r.weights.length;e<t;e++)s.morphTargetInfluences[e]=r.weights[e];if(r.extras&&Array.isArray(r.extras.targetNames)){var n=r.extras.targetNames;if(s.morphTargetInfluences.length===n.length){s.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++)s.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(e,h),e.name=c.createUniqueName(h.name||"mesh_"+l),I(e,h),i.extensions&&L(u,e,i),c.assignFinalMaterial(e),n.push(e)}if(1===n.length)return n[0];const o=new v.Group;for(let e=0,t=n.length;e<t;e++)o.add(n[e]);return o})}loadCamera(e){let t;var s=this.json.cameras[e],e=s[s.type];if(e)return"perspective"===s.type?t=new v.PerspectiveCamera(v.MathUtils.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===s.type&&(t=new v.OrthographicCamera(-e.xmag,e.xmag,e.ymag,-e.ymag,e.znear,e.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),I(t,s),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return s.inverseBindMatrices=e,s})}loadAnimation(f){const g=this.json.animations[f],s=[],r=[],n=[],a=[],o=[];for(let e=0,t=g.channels.length;e<t;e++){const v=g.channels[e],i=g.samplers[v.sampler],l=v.target,c=void 0!==l.node?l.node:l.id,u=void 0!==g.parameters?g.parameters[i.input]:i.input,h=void 0!==g.parameters?g.parameters[i.output]:i.output;s.push(this.getDependency("node",c)),r.push(this.getDependency("accessor",u)),n.push(this.getDependency("accessor",h)),a.push(i),o.push(l)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(n),Promise.all(a),Promise.all(o)]).then(function(n){const s=n[0],r=n[1],a=n[2],o=n[3],i=n[4],l=[];for(let e=0,t=s.length;e<t;e++){const g=s[e],n=r[e],c=a[e],u=o[e],h=i[e];if(void 0!==g){let s;switch(g.updateMatrix(),g.matrixAutoUpdate=!0,b[h.path]){case b.weights:s=v.NumberKeyframeTrack;break;case b.rotation:s=v.QuaternionKeyframeTrack;break;default:s=v.VectorKeyframeTrack}const d=g.name||g.uuid,p=void 0!==u.interpolation?_[u.interpolation]:v.InterpolateLinear,m=[];b[h.path]===b.weights?g.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&m.push(e.name||e.uuid)}):m.push(d);let r=c.array;if(c.normalized){const f=C(r.constructor),g=new Float32Array(r.length);for(let e=0,t=r.length;e<t;e++)g[e]=r[e]*f;r=g}for(let e=0,t=m.length;e<t;e++){const g=new s(m[e]+"."+b[h.path],n.array,r,p);"CUBICSPLINE"===u.interpolation&&(g.createInterpolant=function(e){return new M(this.times,this.values,this.getValueSize()/3,e)},g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(g)}}}const c=g.name||"animation_"+f;return new v.AnimationClip(c,void 0,l)})}createNodeMesh(e){const t=this.json,s=this,r=t.nodes[e];return void 0===r.mesh?null:s.getDependency("mesh",r.mesh).then(function(e){const t=s._getNodeRef(s.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(s){if(s.isMesh)for(let e=0,t=r.weights.length;e<t;e++)s.morphTargetInfluences[e]=r.weights[e]}),t})}loadNode(n){const e=this.json,t=this.extensions,a=this,o=e.nodes[n],i=o.name?a.createUniqueName(o.name):"";return function(){const t=[],e=a._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(n)});return e&&t.push(e),void 0!==o.camera&&t.push(a.getDependency("camera",o.camera).then(function(e){return a._getNodeRef(a.cameraCache,o.camera,e)})),a._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(n)}).forEach(function(e){t.push(e)}),Promise.all(t)}().then(function(s){let r;if(r=!0===o.isBone?new v.Bone:1<s.length?new v.Group:1===s.length?s[0]:new v.Object3D,r!==s[0])for(let e=0,t=s.length;e<t;e++)r.add(s[e]);if(o.name&&(r.userData.name=o.name,r.name=i),I(r,o),o.extensions&&L(t,r,o),void 0!==o.matrix){const n=new v.Matrix4;n.fromArray(o.matrix),r.applyMatrix4(n)}else void 0!==o.translation&&r.position.fromArray(o.translation),void 0!==o.rotation&&r.quaternion.fromArray(o.rotation),void 0!==o.scale&&r.scale.fromArray(o.scale);return a.associations.set(r,{type:"nodes",index:n}),r})}loadScene(e){const s=this.json,t=this.extensions,r=this.json.scenes[e],n=new v.Group;r.name&&(n.name=this.createUniqueName(r.name)),I(n,r),r.extensions&&L(t,n,r);const a=r.nodes||[],o=[];for(let e=0,t=a.length;e<t;e++)o.push(function a(e,o,i,l){const t=i.nodes[e];return l.getDependency("node",e).then(function(e){if(void 0===t.skin)return e;let o;return l.getDependency("skin",t.skin).then(function(e){o=e;const s=[];for(let e=0,t=o.joints.length;e<t;e++)s.push(l.getDependency("node",o.joints[e]));return Promise.all(s)}).then(function(a){return e.traverse(function(e){if(e.isMesh){const s=[],r=[];for(let e=0,t=a.length;e<t;e++){const n=a[e];if(n){s.push(n);const a=new v.Matrix4;void 0!==o.inverseBindMatrices&&a.fromArray(o.inverseBindMatrices.array,16*e),r.push(a)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[e])}e.bind(new v.Skeleton(s,r),e.matrixWorld)}}),e})}).then(function(s){o.add(s);const r=[];if(t.children){const o=t.children;for(let e=0,t=o.length;e<t;e++){const n=o[e];r.push(a(n,s,i,l))}}return Promise.all(r)})}(a[e],n,s,this));return Promise.all(o).then(function(){return n})}}function N(s,e,r){const t=e.attributes,n=[];for(const e in t){const v=A[e]||e.toLowerCase();v in s.attributes||n.push(function(e,t){return r.getDependency("accessor",e).then(function(e){s.setAttribute(t,e)})}(t[e],v))}if(void 0!==e.indices&&!s.index){const v=r.getDependency("accessor",e.indices).then(function(e){s.setIndex(e)});n.push(v)}return I(s,e),function(s,r,n){const a=r.attributes,o=new v.Box3;if(void 0!==a.POSITION){{const s=n.json.accessors[a.POSITION],r=s.min,i=s.max;if(void 0===r||void 0===i)return console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new v.Vector3(r[0],r[1],r[2]),new v.Vector3(i[0],i[1],i[2])),s.normalized){const r=C(y[s.componentType]);o.min.multiplyScalar(r),o.max.multiplyScalar(r)}}const i=r.targets;if(void 0!==i){const s=new v.Vector3,r=new v.Vector3;for(let e=0,t=i.length;e<t;e++){const a=i[e];if(void 0!==a.POSITION){const v=n.json.accessors[a.POSITION],o=v.min,i=v.max;if(void 0!==o&&void 0!==i){if(r.setX(Math.max(Math.abs(o[0]),Math.abs(i[0]))),r.setY(Math.max(Math.abs(o[1]),Math.abs(i[1]))),r.setZ(Math.max(Math.abs(o[2]),Math.abs(i[2]))),v.normalized){const s=C(y[v.componentType]);r.multiplyScalar(s)}s.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(s)}s.boundingBox=o;const e=new v.Sphere;o.getCenter(e.center),e.radius=o.min.distanceTo(o.max)/2,s.boundingSphere=e}}(s,e,r),Promise.all(n).then(function(){return void 0!==e.targets?function(s,r,n){let a=!1,o=!1;for(let e=0,t=r.length;e<t;e++){const n=r[e];if(void 0!==n.POSITION&&(a=!0),void 0!==n.NORMAL&&(o=!0),a&&o)break}if(!a&&!o)return Promise.resolve(s);const i=[],l=[];for(let e=0,t=r.length;e<t;e++){var c=r[e];if(a){const r=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):s.attributes.position;i.push(r)}if(o){const r=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):s.attributes.normal;l.push(r)}}return Promise.all([Promise.all(i),Promise.all(l)]).then(function(e){var t=e[0],e=e[1];return a&&(s.morphAttributes.position=t),o&&(s.morphAttributes.normal=e),s.morphTargetsRelative=!0,s})}(s,e.targets,r):s})}function F(e,t){let s=e.getIndex();if(null===s){const t=[],v=e.getAttribute("position");if(void 0===v)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<v.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const r=s.count-2,n=[];if(t===v.TriangleFanDrawMode)for(let e=1;e<=r;e++)n.push(s.getX(0)),n.push(s.getX(e)),n.push(s.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(n.push(s.getX(e)),n.push(s.getX(e+1)),n.push(s.getX(e+2))):(n.push(s.getX(e+2)),n.push(s.getX(e+1)),n.push(s.getX(e)));n.length/3!=r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(n),a}class U{constructor({anchor:e={lat:0,lng:0,altitude:0},rotation:t=new Float32Array([0,0,0]),scale:s=new Float32Array([1,1,1]),scene:r=new v.Scene,map:n}){this.overlay=new google.maps.WebglOverlayView,this.renderer=null,this.camera=null,this.anchor=e,this.rotation=t,this.scale=s,this.scene=r,this.scene.rotation.x=Math.PI/2,this.overlay.onAdd=this.onAdd.bind(this),this.overlay.onRemove=this.onRemove.bind(this),this.overlay.onContextLost=this.onContextLost.bind(this),this.overlay.onContextRestored=this.onContextRestored.bind(this),this.overlay.onDraw=this.onDraw.bind(this),this.camera=new v.PerspectiveCamera,n&&this.setMap(n)}onAdd(){}onRemove(){}getMap(){return this.overlay.getMap()}requestRedraw(){this.overlay.requestRedraw()}setMap(e){this.overlay.setMap(e)}addListener(e,t){return this.overlay.addListener(e,t)}bindTo(e,t,s,r){this.overlay.bindTo(e,t,s,r)}get(e){return this.overlay.get(e)}notify(e){this.overlay.notify(e)}set(e,t){this.overlay.set(e,t)}setValues(e){this.overlay.setValues(e)}unbind(e){this.overlay.unbind(e)}unbindAll(){this.overlay.unbindAll()}onContextRestored(e){this.renderer=new v.WebGLRenderer(Object.assign({canvas:e.canvas,context:e},e.getContextAttributes())),this.renderer.autoClear=!1,this.renderer.autoClearDepth=!1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=v.PCFSoftShadowMap,this.renderer.outputEncoding=v.sRGBEncoding;var{width:t,height:s,clientWidth:e}=e.canvas;this.renderer.setPixelRatio(t/e),this.renderer.setSize(t,s,!1)}onContextLost(){this.renderer&&(this.renderer.dispose(),this.renderer=null)}onDraw(e,t){var{lat:s,lng:r,altitude:n}=this.anchor;this.camera.projectionMatrix.fromArray(t.fromLatLngAltitude({lat:s,lng:r},n,this.rotation,this.scale)),e.disable(e.SCISSOR_TEST),this.requestRedraw(),this.renderer.render(this.scene,this.camera),this.renderer.resetState()}}let H;Math.PI;const D={tilt:0,heading:0,zoom:18,center:{lat:35.6594945,lng:139.6999859},mapId:"15431d2b469f209e",disableDefaultUI:!0,gestureHandling:"none",keyboardShortcuts:!1};var k,B=window;for(k in e)B[k]=e[k];e.__esModule&&Object.defineProperty(B,"__esModule",{value:!0})})()</script><div id="iframe-contents"><div id="map"class="map"></div><script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap&v=beta&channel=1"async></script></div>